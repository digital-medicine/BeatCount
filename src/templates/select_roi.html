<!DOCTYPE html>
<html>
<head>
    <title>Select ROIs</title>
    <style>
        #video-container {
            position: relative;
            width: 640px;
            height: 480px;
        }

        #video {
            width: 100%;
            height: 100%;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #overlay canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <h1>Select ROIs</h1>
    <div id="video-container">
        <video id="video" width="640" height="480" autoplay loop></video>
        <div id="overlay">
            <canvas id="roi-canvas"></canvas>
        </div>
    </div>
    <form id="roi-form" method="POST" action="/process">
        <input type="hidden" id="filename" name="filename" value="{{ filename }}">
        <input type="hidden" id="roi-coords" name="roi_coords[]" value="">
        <input type="submit" value="Process ROIs">
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            var video = document.getElementById('video');
            var canvas = document.getElementById('roi-canvas');
            var overlay = document.getElementById('overlay');
            var doneBtn = document.getElementById('done-btn');
            var roiForm = document.getElementById('roi-form');
            var roiCoords = [];

            // Disable the form submission initially
            roiForm.addEventListener('submit', function(event) {
                if (roiCoords.length === 0) {
                    event.preventDefault();
                    alert('Please select at least one ROI');
                } else {
                    document.getElementById('roi-coords').value = JSON.stringify(roiCoords);
                }
            });

            // Add event listener for the "Done" button
            doneBtn.addEventListener('click', function() {
                roiForm.submit();
            });

            // Start playing the video
            video.src = "{{ url_for('static', filename='uploads/' ~ filename) }}";
            video.load();
        });
    </script>
</body>
</html>
